sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageStrip","sap/ui/core/Core","sap/m/MessageBox"],function(e,t,l,s,n,o,i){"use strict";var r=[];var a={};var c={};var d={};var u=[];var m={};var f=false;var h=false;var E=false;var p={};return e.extend("DIOR.FR.zfrswbdioovt.controller.Main",{onInit:function(){this._apElementCounter=0;this._reElementCounter=0;this._ApSelectedAll=false;this._ReSelectedAll=false},onSelectAllEmp:function(e){const t="/OvertimeEventSet";if(!f){e.getSource().setText("Désélectionner tous les employés");this.byId("EmployeeListCombo").setVisible(false);f=true;this.byId("OvtEventsTab").bindItems({path:t,model:"employees",template:this.byId("TableItemTemplate"),templateShareable:true})}else{e.getSource().setText("Sélectionner tous les employés");this.byId("EmployeeListCombo").setVisible(true);f=false;this.byId("OvtEventsTab").unbindItems();let t=this.byId("EmployeeListCombo").getSelectedKeys();this.byId("EmployeeListCombo").removeSelectedKeys(t)}},onSectionChange:function(e){var t=e.getParameter("changedItem");var n=e.getParameter("selected");if(n){a[t.getKey()]=t.getKey();m[t.getKey()]=new l("EmployeeID",s.EQ,""+t.getKey()+"")}else{delete a[t.getKey()];delete m[t.getKey()]}},onSectionFinish:function(e){const t="/OvertimeEventSet";console.log(Object.values(m));console.log(Object.values(a));r=Object.values(a);u=Object.values(m);if(Object.values(m).length>0){this.byId("OvtEventsTab").bindItems({path:t,model:"employees",template:this.byId("TableItemTemplate"),templateShareable:true,filters:u})}else{this.byId("OvtEventsTab").unbindItems()}},onSelectedAp:function(e){const t=e.getParameter("selected");const l=e.getSource();const s=l.getParent();const n=s.getCells();const o=e.getSource().getBindingContext("employees").getObject();if(t){this._apElementCounter+=1;n[7].setEnabled(false);c[o.EntryKey]=o;this._toggleApBtn()}else{this._apElementCounter-=1;delete c[o.EntryKey];n[7].setEnabled(true);this._toggleApBtn()}},onSelectedRe:function(e){const t=e.getParameter("selected");const l=e.getSource();const s=l.getParent();const n=s.getCells();const o=e.getSource().getBindingContext("employees").getObject();if(t){this._reElementCounter+=1;d[o.EntryKey]=o;n[6].setEnabled(false);this._toggleReBtn()}else{this._reElementCounter-=1;delete d[o.EntryKey];n[6].setEnabled(true);this._toggleReBtn()}},_toggleApBtn:function(){let e=this.byId("apBtn");let t=this._apElementCounter+this._reElementCounter;if(t>0&&e.getEnabled()===false){e.setEnabled(true)}else if(t===0&&e.getEnabled()===true){e.setEnabled(false)}},_toggleReBtn:function(){let e=this.byId("apBtn");let t=this._apElementCounter+this._reElementCounter;if(t>0&&e.getEnabled()===false){e.setEnabled(true)}else if(t===0&&e.getEnabled()===true){e.setEnabled(false)}},onSelectAllAp:function(){const e=this.byId("OvtEventsTab");const t=e.getItems();t.forEach(e=>{const t=e.getCells();const l=t[6];const s=l.getSelected();const n=l.getEnabled();const o=t[7];const i=o.getSelected();const r=o.getEnabled();const a=e.getBindingContext("employees").getObject();if(!this._ApSelectedAll&&!this._ReSelectedAll){if(!s){this._apElementCounter+=1;o.setSelected(false);l.setEnabled(true);c[a.EntryKey]=a;if(i){this._reElementCounter-=1;delete d[a.EntryKey]}}l.setSelected(true);o.setEnabled(false)}else if(this._ApSelectedAll&&!this._ReSelectedAll){if(s){this._apElementCounter-=1;delete c[a.EntryKey]}l.setSelected(false);o.setEnabled(true)}else if(!this._ApSelectedAll&&this._ReSelectedAll){if(!s){this._apElementCounter+=1;c[a.EntryKey]=a}l.setSelected(true);l.setEnabled(true);if(i){this._reElementCounter-=1;delete d[a.EntryKey]}o.setEnabled(false);o.setSelected(false)}});if(!this._ApSelectedAll&&!this._ReSelectedAll){this._ApSelectedAll=true}else if(this._ApSelectedAll&&!this._ReSelectedAll){this._ApSelectedAll=false}else if(!this._ApSelectedAll&&this._ReSelectedAll){this._ApSelectedAll=true;this._ReSelectedAll=false}this._toggleApBtn()},onSelectAllRe:function(){const e=this.byId("OvtEventsTab");const t=e.getItems();t.forEach(e=>{const t=e.getCells();const l=t[6];const s=l.getSelected();const n=l.getEnabled();const o=t[7];const i=o.getSelected();const r=o.getEnabled();const a=e.getBindingContext("employees").getObject();if(!this._ApSelectedAll&&!this._ReSelectedAll){if(!i){this._reElementCounter+=1;l.setSelected(false);o.setEnabled(true);d[a.EntryKey]=a;if(s){this._apElementCounter-=1;delete c[a.EntryKey]}}o.setSelected(true);l.setEnabled(false)}else if(!this._ApSelectedAll&&this._ReSelectedAll){if(i){this._reElementCounter-=1;delete d[a.EntryKey]}o.setSelected(false);l.setEnabled(true)}else if(this._ApSelectedAll&&!this._ReSelectedAll){if(!i){this._reElementCounter+=1;d[a.EntryKey]=a}o.setSelected(true);o.setEnabled(true);if(s){this._apElementCounter-=1;delete c[a.EntryKey]}l.setEnabled(false);l.setSelected(false)}});if(!this._ApSelectedAll&&!this._ReSelectedAll){this._ReSelectedAll=true}else if(!this._ApSelectedAll&&this._ReSelectedAll){this._ReSelectedAll=false}else if(this._ApSelectedAll&&!this._ReSelectedAll){this._ReSelectedAll=true;this._ApSelectedAll=false}this._toggleApBtn()},onAppAll:function(){i.warning("Êtes-vous sûr de soumettre tous les événements marqués?",{actions:[i.Action.YES,i.Action.NO],emphasizedAction:i.Action.YES,onClose:e=>{if(i.Action.YES===e){console.log(d);console.log(c);let e="";let t=this.getOwnerComponent().getModel("employees");for(const l in c){let s=c[l];e=`/OvertimeEventSet(EmployeeID='${s.EmployeeID}',SeqNum='${s.SeqNum}',WageType='${s.WageType}',EndDay='${s.EndDay}',StartDay='${s.StartDay}')`;s.Approval=1;console.log(E);t.update(e,s,{success:e=>{h=true},error:e=>{let t=JSON.parse(e.responseText);let l=t.error.message.value;let s=t.error.code;let n=s.match(/(\d+)$/);let o=l.match(/\d{8}/gm);if(n[0]==="023"&&E===false){E=true;h=false;i.error(l)}else if(n[0]==="022"){if(p[o[0]]===undefined){p[o[0]]=true;h=false;i.error(l)}}}});delete c[l]}for(const l in d){let s=d[l];e=`/OvertimeEventSet(EmployeeID='${s.EmployeeID}',SeqNum='${s.SeqNum}',WageType='${s.WageType}',EndDay='${s.EndDay}',StartDay='${s.StartDay}')`;s.Approval=2;console.log(s);t.update(e,s,{success:e=>{h=true},error:e=>{let t=JSON.parse(e.responseText);let l=t.error.message.value;let s=t.error.code;let n=s.match(/(\d+)$/);let o=l.match(/\d{8}/gm);if(n[0]==="023"&&E===false){E=true;h=false;i.error(l)}else if(n[0]==="022"){if(p[o[0]]===undefined){p[o[0]]=true;h=false;i.error(l)}}}});delete d[l]}if(this.bUpdateError===true){let e=this.byId("OvtEventsTab");let t=e.getItems();t.forEach(t=>{let l=t.getCells();if(l[6].getSelected()||l[7].getSelected()){e.removeItem(t)}});i.success("Tous les événements ont été traités")}}}})}})});